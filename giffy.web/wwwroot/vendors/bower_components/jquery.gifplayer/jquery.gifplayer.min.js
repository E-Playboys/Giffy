!function(a){function b(a,b){this.previewElement=a,this.options=b,this.animationLoaded=!1}b.prototype={activate:function(){this.wrap(),this.addSpinner(),this.addControl(),this.addEvents()},wrap:function(){this.previewElement.addClass("gifplayer-ready"),this.wrapper=this.previewElement.wrap("<div class='gifplayer-wrapper'></div>").parent(),this.wrapper.css("width",this.previewElement.width()),this.wrapper.css("height",this.previewElement.height()),this.previewElement.css("cursor","pointer")},addSpinner:function(){this.spinnerElement=a("<div class = 'spinner'></div>"),this.wrapper.append(this.spinnerElement),this.spinnerElement.hide()},getOption:function(a){var b=this.previewElement.data(a.toLowerCase());return void 0!=b&&""!=b?b:this.options[a]},addControl:function(){var b=this.getOption("label");this.playElement=a("<ins class='play-gif'>"+b+"</ins>"),this.wrapper.append(this.playElement),this.playElement.css("top",this.previewElement.height()/2-this.playElement.height()/2),this.playElement.css("left",this.previewElement.width()/2-this.playElement.width()/2)},addEvents:function(){var a=this,b=this.getOption("playOn");this.getOption("mode");switch(b){case"click":a.playElement.on("click",function(b){a.loadAnimation()}),a.previewElement.on("click",function(b){a.loadAnimation(),b.preventDefault(),b.stopPropagation()});break;case"hover":a.previewElement.on("click mouseover",function(b){a.loadAnimation(),b.preventDefault(),b.stopPropagation()})}},loadAnimation:function(){this.spinnerElement.show();var a=this.getOption("mode");"gif"==a?this.loadGif():"video"==a&&this.loadVideo()},stopGif:function(){this.gifElement.hide(),this.previewElement.show(),this.playElement.show(),this.resetEvents()},getGif:function(){var a=this.getOption("gif");return void 0!=a&&""!=a?a:this.previewElement.attr("src").replace(".png",".gif").replace(".jpg",".gif")},getWebm:function(){var a=this.getOption("webm");return void 0!=a&&""!=a?a:this.previewElement.attr("src").replace(".png",".webm").replace(".jpg",".webm")},getMp4:function(){var a=this.getOption("mp4");return void 0!=a&&""!=a?a:this.previewElement.attr("src").replace(".png",".mp4").replace(".jpg",".mp4")},loadGif:function(){var b=this;b.playElement.hide(),this.animationLoaded||this.enableAbort();var c=this.getGif(),d=this.previewElement.width(),e=this.previewElement.height();this.gifElement=a("<img class='gp-gif-element' width='"+d+"' height=' "+e+" '/>");var f=this.getOption("wait");f?this.gifElement.load(function(){b.animationLoaded=!0,b.resetEvents(),b.previewElement.hide(),b.wrapper.append(b.gifElement),b.spinnerElement.hide()}):(b.animationLoaded=!0,b.resetEvents(),b.previewElement.hide(),b.wrapper.append(b.gifElement),b.spinnerElement.hide()),this.gifElement.css("cursor","pointer"),this.gifElement.css("position","absolute"),this.gifElement.css("top","0"),this.gifElement.css("left","0"),this.gifElement.attr("src",c),this.gifElement.click(function(c){a(this).remove(),b.previewElement.show(),b.playElement.show(),b.resetEvents(),c.preventDefault(),c.stopPropagation()})},loadVideo:function(){var b=this,c=this.getMp4(),d=this.getWebm(),e=this.previewElement.width(),f=this.previewElement.height();b.videoElement=a('<video class="gp-video-element" width="'+e+'px" height="'+f+'" style="margin:0 auto;width:'+e+"px;height:"+f+'px;" autoplay="autoplay" loop="loop" muted="muted" poster="'+b.previewElement.attr("src")+'"><source type="video/mp4" src="'+c+'"><source type="video/webm" src="'+d+'"></video>');var g=function(){b.spinnerElement.hide(),b.previewElement.hide(),b.playElement.hide(),b.gifLoaded=!0,b.previewElement.hide(),b.wrapper.append(b.videoElement),b.videoPaused=!1,b.videoElement[0].play()},h=function(){4===b.videoElement[0].readyState?(g(),b.animationLoaded=!0):setTimeout(h,100)},i=this.getOption("wait");i?h():g(),b.videoElement.on("click",function(){b.videoPaused?b.resumeVideo():b.pauseVideo()})},pauseVideo:function(){var a=this;a.videoPaused=!0,a.videoElement[0].pause(),a.playElement.show(),a.mouseoverEnabled=!1},resumeVideo:function(){var a=this;a.videoPaused=!1,a.videoElement[0].play(),a.playElement.hide()},enableAbort:function(){var a=this;this.previewElement.click(function(b){a.abortLoading(b)}),this.spinnerElement.click(function(b){a.abortLoading(b)})},abortLoading:function(a){this.spinnerElement.hide(),this.playElement.show(),a.preventDefault(),a.stopPropagation(),this.gifElement.off("load").on("load",function(a){a.preventDefault(),a.stopPropagation()}),this.resetEvents()},resetEvents:function(){this.previewElement.off("click"),this.previewElement.off("mouseover"),this.playElement.off("click"),this.spinnerElement.off("click"),this.addEvents()}},a.fn.gifplayer=function(c){if(!/^(play|pause|stop)$/i.test(c))return this.each(function(){c=a.extend({},a.fn.gifplayer.defaults,c);var d=new b(a(this),c);d.activate()});if(c=c.toLowerCase(),a(this).hasClass("gifplayer-ready")){var d=new b(a(this),null);switch(d.options={},d.options=a.extend({},a.fn.gifplayer.defaults,d.options),d.wrapper=a(this).parent(),d.spinnerElement=d.wrapper.find(".spinner"),d.playElement=d.wrapper.find(".play-gif"),d.gifElement=d.wrapper.find(".gp-gif-element"),d.videoElement=d.wrapper.find(".gp-video-element"),void 0!=d.gifElement?d.options.mode="gif":void 0!=d.videoElement&&(d.options.mode="video"),c){case"play":console.log("play"),d.playElement.trigger("click");break;case"stop":console.log("stop"),"gif"==d.options.mode?d.stopGif():"video"==d.options.mode&&d.pauseVideo()}}else console.log("Not a valid gifplayer element")},a.fn.gifplayer.defaults={label:"GIF",playOn:"click",mode:"gif",gif:"",mp4:"",webm:"",wait:!1}}(jQuery);